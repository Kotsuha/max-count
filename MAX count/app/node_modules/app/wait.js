"use strict";

const wait = function(ms, param) {
	return new Promise(function(res) { // , rej
		// function fn(foo, bar, baz) {
		// 	console.log(foo, bar, baz);
		// }
		// setTimeout.apply(global, [fn, 3000, "foo!", "bar!", "baz!"]);
		// // But resolve() only has one parameter
		setTimeout(res, ms, param);
	});
};

const someAsyncOperation = function(ms, isOk, result, err) {
	// return new Promise((res, rej) => {
	// 	wait(ms)
	// 		.then(function() {
	// 			if (isOk) res(result);
	// 			return rej(new Error(err));
	// 		});
	// });
	// What's their difference?
	return wait(ms).then(function() {
		return isOk ? Promise.resolve(result) : Promise.reject(new Error(err));
	});
};

const dottedWait = function(sec) {
	sec = parseInt(sec);
	return new Promise(async function(resolve) {
		for (; sec > 0; sec--) {
			process.stdout.write("\x1b[K");
			for (let i = 1; i < sec; i++) {
				process.stdout.write(".");
			}
			process.stdout.write("\r");
			await wait(1000);
		}
		resolve();
	});
};

module.exports = {
	wait,
	dottedWait,
	someAsyncOperation
};
