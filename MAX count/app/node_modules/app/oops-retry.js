"use strict";

const wait = require("app/wait").dottedWait;

const oopsRetry = function(fn, oops, ms = 0) {
	const newFn = function(...args) {
		const retry = () => oopsRetry(fn, oops-1, ms).apply(undefined, args);

		return fn.apply(undefined, args)
			.then((obj) => obj)
			.catch((err) => (oops <= 0) 
				? Promise.reject(err) 
				: wait(ms).then(retry)
			);
	};
	return newFn;
};

module.exports = oopsRetry;
