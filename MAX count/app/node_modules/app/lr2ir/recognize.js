"use strict";

const VIEW = require("./const/view");

const TYPES = [
	{
		type: VIEW.MAINTAIN,
		recognize: ($) => ($("a").first().text() === "Twitter")
	},
	{
		type: VIEW.MY_PAGE,
		recognize: ($) => ($("h3").first().text().indexOf("のマイページ") !== -1)
	},
	{
		type: VIEW.MY_LIST,
		recognize: ($) => ($("h3").first().text().indexOf("のプレイデータ") !== -1)
	},
	{
		type: VIEW.SONG_RANKING,
		recognize: function($) {
			const isRanking = ($("h3").filter(function(index, ele) {
				return $(ele).text() === "ランキング";
			}).length > 0);
			const isCourse = ($("h2").filter(function(index, ele) {
				return $(ele).text().indexOf("コース作成者") !== -1;
			}).length > 0);
			return (isRanking && !isCourse);
		}
	}
];

function recognize($) {	
	let type = VIEW.UNKNOWN;
	for (let i = 0; i < TYPES.length; i++) {
		if (TYPES[i].recognize($)) {
			type = TYPES[i].type;
			break;
		}
	}
	return type;
}

module.exports = recognize;
