<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title></title>
	<script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		/* eslint-disable */
		$(function() {
			const socket = io();
			
			const $form = $("#form");
			const $cancel = $("#cancel");
			const $logger = $("#logger");
			const logger = $logger[0];
			const $scroll = $("#scroll");

			$form.submit(function() {
				const lr2id = $("#lr2id").val();
				socket.emit("rival-request", lr2id);
				return false;
			});
			$cancel.click(function() {
				const lr2id = $("#lr2id").val();
				socket.emit("cancel-rival-request", lr2id);
			});

			socket.on("log", function(data) {
				console.log(data);
				logger.value += (data + "\n");
				if ($scroll.prop("checked")) {
					$logger.scrollTop(logger.scrollHeight - $logger.height());
				}
			});

			socket.on("users", function(data) {
				updateTitle(data);
			});

			const updateTitle = function(users) {
				let title = "(^^)";
				if (users) title += " " + users;
				document.title = title;
			};

			const $clear = $("#clear");
			$clear.click(function() {
				logger.value = "";
			});
		});
	</script>
	<style>
		code {
			font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
			font-size: 12px;

			padding: .2em .4em;
			margin: 0;
			font-size: 85%;
			background-color: rgba(27,31,35,.05);
			border-radius: 3px;
		}

		#logger {
			background: black;
			color: silver;
		}
	</style>
</head>
<body>
	<div>
		<form action="" id="form">
			<label for="lr2id">LR2ID</label>
			<input type="number" id="lr2id">
			<input type="submit">
			<input type="button" id="cancel" value="Cancel">
		</form>
	</div>
	<div>
		<textarea id="logger" cols="80" rows="10" readonly></textarea>
	</div>
	<div>
		<button id="clear">Clear</button>
		<input type="checkbox" id="scroll" checked><label for="scroll">Scroll</label>
	</div>
	<div>
		<p>How to use:</p>
		<p>Enter your LR2ID and hit the submit button. The checking should start. It will take a fairly long time, so just leave it. Do not close the tab if you would like to view the logs or be able to cancel the request. After the checking is done, it should rival you if enough max records are found.</p>
		<p>Please notice that:</p>
		<ul>
			<li>Only a limited number of users can use at the same time. Please refer to the tab title.</li>
			<li>Please enter the ID shown in the url. For example if your ID is 1, please enter <code>1</code> rather than <code>000001</code>.</li>
			<li>You can only cancel requests that are sent from the same tab. You cannot cancel a request after you closed or refresh the tab.</li>
		</ul>
	</div>
	<div>
		<a href="http://www.dream-pro.info/~lavalse/LR2IR/search.cgi" target="_blank">Go to LR2IR</a>
	</div>
</body>
</html>
