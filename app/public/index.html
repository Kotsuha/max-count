<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>(^^)</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- normalize.css -->
	<link rel="stylesheet" href="css/normalize.css">

	<!-- icons8 -->
	<link rel="stylesheet" href="icons8/css/styles.min.css">

	<style>
		/* Test */
		.test-bg {
			background: rgba(255, 0, 255, 0.1);
		}


		/* Stuff */
		code {
			font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
			font-size: 12px;

			padding: .2em .4em;
			margin: 0;
			font-size: 85%;
			background-color: rgba(27,31,35,.05);
			border-radius: 3px;
		}
		.copyleft {
			display: inline-block;
			transform: rotateY(180deg);
		}
		ul.list-btns {
			margin: 0;
			padding: 0;
		}
		ul.list-btns li {
			display: block;
			float: left;
		}
		ul.list-btns a,
		ul.list-btns label {
			display: inline-block;
		}


		/* Page Specific - Visual or Component */
		#c0nsole {
			background: black;
			color: silver;

			width: 100%;
			height: 100%;
			box-sizing: border-box;
			border: 0;

			font-family: monospace;
			line-height: normal;

			resize: none;
		}
		#c0nsole-toolbar {
			color: silver;
			padding: 2px 3px;

			position: absolute;
			bottom: 0;
			/*right: 0;*/
			margin: 2px;
			background: rgba(0, 0, 0, 0.7);
			border: solid silver thin;
			border-radius: 1px;

			opacity: 0;
			-webkit-transition: opacity 0.4s;
			-o-transition: opacity 0.4s;
			transition: opacity 0.4s;
		}
		#sub:hover #c0nsole-toolbar,
		#c0nsole:focus + #c0nsole-toolbar {
			opacity: 1;
		}
		#c0nsole-toolbar a,
		#c0nsole-toolbar label {
			color: silver;
			padding: 5px;
		}
		#c0nsole-toolbar a:hover,
		#c0nsole-toolbar label:hover {
			color: white;
			background: rgba(255, 255, 255, 0.2);
			border-radius: 3px;
		}
		#c0nsole-toolbar a:active,
		#c0nsole-toolbar label:active {
			background: rgba(255, 255, 255, 0.3);

			/* Doesn't work in Firefox. Will make this whole {} rule not working. */
			/*position: relative;
			top: 1px;
			left: 1px;*/
		}

		/* Page Specific - Layout */
		#page {
			display: flex;
			flex-direction: row;

			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;

			overflow: hidden; /* 暫時 for Chrome */
		}
		#main {
			display: flex;
			flex-direction: column;

			padding: 8px;

			overflow-y: auto;
		}
		.section-container {
			margin-top: -16px;
		}
		section, footer {
			padding-top: 16px;
		}
		#footer-container {
			margin-top: auto; /* 吐血 https://stackoverflow.com/a/35125244/6378871 */
		}


		/* 模仿 IR */
		/*body {*/
		#main {
			/*background: #000;
			color: #EEF;*/
			/*font-size: 10pt;*/
		}
	</style>
</head>
<body>
	<div id="page">
		<div id="main">
			<header>
				<h1>max count</h1>
			</header>
			
			<div class="section-container">
				<section>
					<form id="form" action="">
						<label for="lr2id-field">LR2ID <input id="lr2id-field" type="number"></label>
						<input id="submit-btn" type="submit">
						<input id="cancel-btn" type="button" value="Cancel">
					</form>
				</section>

				<section>
					<button id="instruction-btn">How to use 使い方</button>
					<div id="instruction" hidden>
						<p>How to use:<br>使い方:</p>
						<p>Enter your LR2ID and hit the submit button. The checking should start. It will take a fairly long time, so just leave it. Do not close or refresh the tab if you would like to view the logs or be able to cancel the request. After the checking is done, it should rival you if enough max records are found.<br>LR2IDを入力し、送信ボタンを押してください。チェックが開始されます。かなり長い時間がかかりますので、そのままにしておいてください。ログを表示したり、リクエストをキャンセルしたりする場合は、タブを閉じたり更新したりしないでください。チェックが完了した後、十分なMAXが見つかると、そのIDをライバルに追加するはずです。</p>
						<p>Please notice that:<br>注意:</p>
						<ul>
							<li>Only a limited number of users can use at the same time. Please refer to the tab title.<br>限られた数のユーザーしか同時に使用することはできません。タブのタイトルを参照してください。</li>
							<li>Please enter the ID shown in the url. For example if your ID is 1, please enter <code>1</code> rather than <code>000001</code>.<br>URLに表示されているIDを入力してください。 たとえば、IDが1の場合は、<code>000001</code>ではなく<code>1</code>を入力してください。</li>
							<li>You can only cancel requests that are sent from the same tab. You cannot cancel a request after you close or refresh the tab.<br>同じタブから送信されたリクエストのみを取り消すことができます。 タブを閉じるか、または更新した後、リクエストを取り消すことはできません。</li>
							<li>Current UI is crappy I know :( Hopefully it will be improved in the future.<br>今のUIは悪い(；ω；)﻿わかります。</li>
						</ul>
					</div>
				</section>

				<section>
					<a href="http://www.dream-pro.info/~lavalse/LR2IR/search.cgi" target="_blank">Go to LR2IR</a>
				</section>
			</div>

			<div id="footer-container">
				<footer><small><span class="copyleft">&copy;</span> 2018 Kotsuha | <a href="https://icons8.com" target="_blank">Icon pack by Icons8</a></small></footer>
			</div>
		</div>

		<div id="sub">
			<textarea id="c0nsole" cols="80" rows="10" readonly></textarea>
			<div id="c0nsole-toolbar">
				<ul class="list-btns">
					<li><a id="layout-btn" href="javascript:;" title="Dock to right/bottom"><i class="icons8-bottom-docking"></i></a></li>
					<li><a id="clear-btn" href="javascript:;" title="Clear logs"><i class="icons8-clear-bin"></i></a></li>
					<li><label title="Toggle autoscrolling"><input id="scroll-cb" type="checkbox" checked class="icons8-checkbox"><i class="icons8-checkbox"></i> Autoscroll with output</label></li>
				</ul>
			</div>
		</div>
	</div>


	<!-- jQuery 系列 -->
	<script src="js/jquery-3.3.1.min.js"></script>

	<!-- Split.js -->
	<style>
		.gutter {
		  background-color: #eee;
		  background-repeat: no-repeat;
		  background-position: 50%;
		}

		.gutter.gutter-vertical {
			background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFAQMAAABo7865AAAABlBMVEVHcEzMzMzyAv2sAAAAAXRSTlMAQObYZgAAABBJREFUeF5jOAMEEAIEEFwAn3kMwcB6I2AAAAAASUVORK5CYII=");
			cursor: ns-resize;
		}

		.gutter.gutter-horizontal {
			background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==");
			cursor: ew-resize;
		}

		.split {
		  -webkit-box-sizing: border-box;
		     -moz-box-sizing: border-box;
		          box-sizing: border-box;
		}
	</style>
	<script src="js/split.min.js"></script>

	<script>
		(function() {
			// 雜
			var $instructionBtn = $("#instruction-btn");
			var $instruction = $("#instruction");
			$instructionBtn.click(function() {
				$instruction.slideToggle();
			});

			// Split.js & Layout 相關
			var Orientation = {
				Landscape: {},
				Portrait: {},
				Square: {},
				getCurrent: function() {
					var width = document.documentElement.clientWidth;
					var height = document.documentElement.clientHeight;

					if (width > height) {
						return this.Landscape;
					}
					else if (width < height) {
						return this.Portrait;
					}
					else {
						return this.Square;
					}
				}
			};
			var Layout = {
				Horizontal: {},
				Vertical: {}
			};
			var currentLayout = null;

			var page = document.getElementById("page");
			var splitInstance = null;
			var layoutBtn = document.getElementById("layout-btn"),
			    layoutBtnIcon = layoutBtn.getElementsByTagName("i")[0];
			var layoutH = function() {
				page.style.flexDirection = "row";
				if (splitInstance) splitInstance.destroy();
				splitInstance = Split(["#main", "#sub"], {
					direction: "horizontal"
				});
				currentLayout = Layout.Horizontal;

				layoutBtnIcon.classList.remove("icons8-right-docking");
				layoutBtnIcon.classList.add("icons8-bottom-docking");
			};
			var layoutV = function() {
				page.style.flexDirection = "column";
				if (splitInstance) splitInstance.destroy();
				splitInstance = Split(["#main", "#sub"], {
					direction: "vertical"
				});
				currentLayout = Layout.Vertical;

				layoutBtnIcon.classList.remove("icons8-bottom-docking");
				layoutBtnIcon.classList.add("icons8-right-docking");
			};
			var layout = function() {
				switch (Orientation.getCurrent()) {
					case Orientation.Landscape:
					case Orientation.Square:
						layoutH();
						return;
					case Orientation.Portrait:
						layoutV();
						return;
				}
			};
			var layoutIfNeeded = function() {
				switch (Orientation.getCurrent()) {
					case Orientation.Landscape:
						if (currentLayout !== Layout.Horizontal) layoutH();
						return;
					case Orientation.Portrait:
						if (currentLayout !== Layout.Vertical) layoutV();
						return;
					// case Orientation.Square: // 有需要再說吧
				}
			};
			var toggleLayout = function() {
				if (currentLayout === Layout.Horizontal) {
					layoutV();
				} else {
					layoutH();
				}
			};

			layout();
			// window.addEventListener("resize", layoutIfNeeded);
			layoutBtn.addEventListener("click", toggleLayout);


			// c0nsole toolbar 其他有獨立作用的按鈕
			var c0nsole = document.getElementById("c0nsole");
			var clearBtn = document.getElementById("clear-btn");
			clearBtn.addEventListener("click", function() {
				c0nsole.value = "";
			});
		})();
	</script>

	<!-- max-count 本體相關 -->
	<script src="/socket.io/socket.io.js"></script>
	<script>
		/* eslint-disable */
		(function() {

			if (typeof io === "undefined") { // https://stackoverflow.com/questions/5113374/javascript-check-if-variable-exists-is-defined-initialized
				return;
			}

			const socket = io();

			const $form = $("#form");
			const $lr2idField = $("#lr2id-field");
			const $cancel = $("#cancel-btn");

			$form.submit(function() {
				const lr2id = $lr2idField.val();
				socket.emit("rival-request", lr2id);
				return false;
			});

			$cancel.click(function() {
				const lr2id = $lr2idField.val();
				socket.emit("cancel-rival-request", lr2id);
			});

			const $c0nsole = $("#c0nsole"), c0nsole = $c0nsole[0];
			const $scrollCb = $("#scroll-cb");

			socket.on("log", function(data) {
				// console.log(data);
				c0nsole.value += (data + "\n");
				if ($scrollCb.prop("checked")) {
					$c0nsole.scrollTop(c0nsole.scrollHeight - $c0nsole.height());
				}
			});

			const initialTitle = document.title;
			const updateTitle = function(users) {
				let newTitle = initialTitle;
				if (users) newTitle += " " + users;
				document.title = newTitle;
			};

			socket.on("users", function(data) {
				updateTitle(data);
			});
		})();
	</script>
</body>
</html>