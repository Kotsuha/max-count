<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="robots" content="noindex, nofollow">
	<title>(^^)</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- normalize.css -->
	<link rel="stylesheet" href="css/normalize.min.css">

	<!-- icons8 -->
	<link rel="stylesheet" href="icons8/css/styles.min.css">

	<!-- 自己的 -->
	<link rel="stylesheet" href="css/styles.min.css"></link>
</head>

<!-- lang="ja" 只是為了讓渲染使用日文字體 -->
<body lang="ja">

	<!-- Loading Screen -->
	<div class="loading-screen">
		<div class="spinner">
		  <div class="rect1"></div>
		  <div class="rect2"></div>
		  <div class="rect3"></div>
		  <div class="rect4"></div>
		  <div class="rect5"></div>
		</div>
	</div>

	<!-- The page -->
	<div id="page">
		<div id="main">
			<header>
				<h1>max count</h1>
			</header>

			<div>
				<form id="form" action="">
					<label for="lr2id-field">LR2ID <input id="lr2id-field" type="number"></label>
					<input id="submit-btn" type="submit">
					<input id="cancel-btn" type="button" value="Cancel">
				</form>
			</div>

			<div><br></div>

			<div style="background: rgba(0,0,0,0.03);">
				<button id="instruction-btn">How to use 使い方</button>
				<div id="instruction" hidden>
					<div>
						<h4>How to use</h4>
						<p>Enter your ID and press the submit button. The check will start.</p>
						<p>It may take <span class="more-info" title="The players I have tested: 10 mins (min) - 50 mins (max)">a fairly long time</span>. It is recommended to just leave it. Do not close or refresh the page if you would like to view logs or be able to cancel the request.</p>
						<p>After the check is done, if enough MAXs are found, the ID will be rivaled.</p>
						<p>Please note that:</p>
						<ul>
							<li>Please enter the ID shown in the URL (the number after <code>playerid=</code>) instead of the one shown in the My Page (マイページ) table. For example, if your ID is 1, please enter <code>1</code> rather than <code>000001</code>.</li>
							<li>There is a maximum number of people that can use at the same time. Please refer to the tab title. This is in order to not make the LR2IR server too busy, plus I don't think there will be many people using this...</li>
							<li>A request can be canceled by only the same tab which sends it. A request cannot be canceled after the tab is closed or refreshed.</li>
						</ul>
					</div>

					<hr>

					<div>
						<h4>使い方</h4>
						<p>IDを入力し、送信ボタンを押してください。チェックが開始されます。</p>
						<p><span class="more-info" title="私がチェックしたプレーヤー、最短時間は約10分、最長は約50分です">かなり長い時間</span>がかかりますので、そのまま放置することをお勧めします。ログを表示したり、リクエストを取り消したい場合は、ページを閉じたり更新したりしないでください。</p>
						<p>チェックが完了した後、十分な理論値が見つかると、そのIDがライバルリストに追加されるはずです。</p>
						<p>注意：</p>
						<ul>
							<li>マイページの表に表示されているIDではなく、URLに表示されているID（<code>playerid=</code>の後の数字）を入力してください。たとえば、IDが1の場合は、<code>000001</code>ではなく<code>1</code>を入力してください。</li>
							<li>同時に使用できる最大人数があります。タブのタイトルを参照してください。LR2IRサーバーをビジー状態にしないためです。そして、私はこれを使用している多くの人々が存在するとは思わない...</li>
							<li>リクエストを送信したのと同じタブからリクエストを取り消すことができます。タブが閉じられたり、更新されたりしたら、リクエストを取り消すことはできません。</li>
						</ul>
					</div>

					<hr>

					<div lang="zh-Hant">
						<h4>用法</h4>
						<p>輸入你的 ID 並按下提交按鈕，檢查就會開始了。</p>
						<p>檢查可能會花上<span class="more-info" title="我測試過的玩家，最短約 10 分鐘，最長約 50 分鐘">滿長一段時間</span>，建議放置，並且途中不要關閉或重整網頁，否則將無法看 log 或取消請求。</p>
						<p>檢查結束後，如果有找到足夠的理論值，該 ID 應該就會被加進ライバル了。</p>
						<p>注意：</p>
						<ul>
							<li>ID 請用網址 <code>playerid=</code> 後面的數字，不要用マイページ表格裡的。例如：如果你的 ID 是 1，請輸入 <code>1</code>，不要輸入 <code>000001</code>。</li>
							<li>為了不要讓 LR2IR 伺服器變的很忙，並且我覺得會來用這個的人應該不多吧... 總之有同時使用的人數上限。請參照分頁標題。</li>
							<li>哪個分頁送出的請求只能由哪個分頁取消。重整或關閉分頁以後，請求就無法取消。</li>
						</ul>
					</div>
				</div>
			</div>

			<div><br></div>

			<div>
				<a href="http://www.dream-pro.info/~lavalse/LR2IR/search.cgi" target="_blank">Go to LR2IR</a>
			</div>


			<div id="footer-container">
				<div><br></div>

				<footer>
					<small><span class="copyleft">&copy;</span> 2018 Kotsuha | <a id="fs-btn" href="javascript:;" title="Fullscreen"><i class="icons8-full-screen"></i></a> | <a href="https://github.com/Kotsuha/max-count" target="_blank">GitHub</a> | <a href="https://icons8.com" target="_blank">Icon pack by Icons8</a></small>
				</footer>
			</div>
		</div>
		<div id="sub">
			<div id="c0nsole-container">
				<textarea cols="80" rows="10" readonly id="c0nsole"></textarea>
				<div id="c0nsole-toolbar">
					<ul class="ul-btns">
						<li><a id="layout-btn" href="javascript:;" title="Dock to right/bottom"><i class="icons8-bottom-docking"></i></a></li>
						<li><a id="clear-btn" href="javascript:;" title="Clear logs"><i class="icons8-clear-bin"></i></a></li>
						<li><label title="Toggle autoscrolling"><input id="scroll-cb" type="checkbox" checked class="icons8-checkbox"><i class="icons8-checkbox"></i> Autoscroll with output</label></li>
					</ul>
				</div>
			</div>
		</div>
	</div>

	<!-- jQuery CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<!-- jQuery local fallback -->
	<script>window.jQuery || document.write("<script src='js/jquery-3.3.1.min.js'><\/script>");</script>

	<script>
		// 雜 (比較單純、依賴關係比較少的東西擺這邊)
		(function() {
			var $instructionBtn = $("#instruction-btn");
			var $instruction = $("#instruction");
			$instructionBtn.on("click", function() {
				$instruction.animate({
					opacity: "toggle",
					height: "toggle"
				});
			});

			var c0nsole = document.getElementById("c0nsole");
			var clearBtn = document.getElementById("clear-btn");
			clearBtn.addEventListener("click", function() {
				c0nsole.value = "";
			});
		})();
	</script>

	<!-- Split.js -->
	<style>
		.gutter {
			background-color: #eee;
			background-repeat: no-repeat;
			background-position: 50%;
		}

		.gutter.gutter-vertical {
			background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFAQMAAABo7865AAAABlBMVEVHcEzMzMzyAv2sAAAAAXRSTlMAQObYZgAAABBJREFUeF5jOAMEEAIEEFwAn3kMwcB6I2AAAAAASUVORK5CYII=");
			cursor: ns-resize;
		}

		.gutter.gutter-horizontal {
			background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==");
			cursor: ew-resize;
		}

		.split {
			-webkit-box-sizing: border-box;
			   -moz-box-sizing: border-box;
			        box-sizing: border-box;
		}
	</style>
	<script src="js/split.min.js"></script>

	<script>
		// Split.js & Layout 相關
		(function() {
			var Orientation = {
				Landscape: {},
				Portrait: {},
				Square: {},
				getCurrent: function() {
					var width = document.documentElement.clientWidth;
					var height = document.documentElement.clientHeight;

					if (width > height) {
						return this.Landscape;
					}
					else if (width < height) {
						return this.Portrait;
					}
					else {
						return this.Square;
					}
				}
			};
			var Layout = {
				Horizontal: {},
				Vertical: {}
			};
			var currentLayout = null;

			var page = document.getElementById("page");
			var splitInstance = null;
			var layoutBtn = document.getElementById("layout-btn"),
			    layoutBtnIcon = layoutBtn.getElementsByTagName("i")[0];
			var layoutH = function() {
				page.style.flexDirection = "row";
				if (splitInstance) splitInstance.destroy();
				splitInstance = Split(["#main", "#sub"], {
					direction: "horizontal",
					minSize: 50
				});
				currentLayout = Layout.Horizontal;

				layoutBtnIcon.classList.remove("icons8-right-docking");
				layoutBtnIcon.classList.add("icons8-bottom-docking");
			};
			var layoutV = function() {
				page.style.flexDirection = "column";
				if (splitInstance) splitInstance.destroy();
				splitInstance = Split(["#main", "#sub"], {
					direction: "vertical",
					minSize: 50
				});
				currentLayout = Layout.Vertical;

				layoutBtnIcon.classList.remove("icons8-bottom-docking");
				layoutBtnIcon.classList.add("icons8-right-docking");
			};
			var layout = function() {
				switch (Orientation.getCurrent()) {
					case Orientation.Landscape:
					case Orientation.Square:
						layoutH();
						return;
					case Orientation.Portrait:
						layoutV();
						return;
				}
			};
			var layoutIfNeeded = function() {
				switch (Orientation.getCurrent()) {
					case Orientation.Landscape:
						if (currentLayout !== Layout.Horizontal) layoutH();
						return;
					case Orientation.Portrait:
						if (currentLayout !== Layout.Vertical) layoutV();
						return;
					// case Orientation.Square: // 有需要再說吧
				}
			};
			var toggleLayout = function() {
				if (currentLayout === Layout.Horizontal) {
					layoutV();
				} else {
					layoutH();
				}
			};

			layout();
			// window.addEventListener("resize", layoutIfNeeded);
			layoutBtn.addEventListener("click", toggleLayout);
		})();
	</script>

	<!-- screenfull.js -->
	<script src="js/screenfull.min.js"></script>
	<script>
		var fsBtn = document.getElementById("fs-btn");
		fsBtn.addEventListener("click", function() {
			if (screenfull.enabled) {
				screenfull.request();
			} else {
				// Ignore or do something else
			}
		});
	</script>

	<!-- max-count 本體相關 -->
	<script src="/socket.io/socket.io.js"></script>
	<script>
		/* eslint-disable */
		(function() {

			if (typeof io === "undefined") { // https://stackoverflow.com/questions/5113374/javascript-check-if-variable-exists-is-defined-initialized
				return;
			}

			const socket = io();

			const $form = $("#form");
			const $lr2idField = $("#lr2id-field");
			const $cancel = $("#cancel-btn");

			$form.submit(function() {
				const lr2id = $lr2idField.val();
				socket.emit("rival-request", lr2id);
				return false;
			});

			$cancel.click(function() {
				const lr2id = $lr2idField.val();
				socket.emit("cancel-rival-request", lr2id);
			});

			const $c0nsole = $("#c0nsole"), c0nsole = $c0nsole[0];
			const $scrollCb = $("#scroll-cb");

			socket.on("log", function(data) {
				// console.log(data);
				c0nsole.value += (data + "\n");
				if ($scrollCb.prop("checked")) {
					$c0nsole.scrollTop(c0nsole.scrollHeight - $c0nsole.height());
				}
			});

			const initialTitle = document.title;
			const updateTitle = function(users) {
				let newTitle = initialTitle;
				if (users) newTitle += " " + users;
				document.title = newTitle;
			};

			socket.on("users", function(data) {
				updateTitle(data);
			});
		})();
	</script>

	<script>
		$(window).on("load", function() {
			// https://stackoverflow.com/questions/4584373/difference-between-window-load-and-document-ready-functions
			$(".loading-screen").fadeOut(1000);
		});
	</script>
</body>
</html>